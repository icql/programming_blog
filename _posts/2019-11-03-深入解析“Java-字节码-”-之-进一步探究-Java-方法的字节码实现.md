---
layout:     post
title:      æ·±å…¥è§£æâ€œJava å­—èŠ‚ç  â€ ä¹‹ ã€Œè¿›ä¸€æ­¥æ¢ç©¶ Java æ–¹æ³•çš„å­—èŠ‚ç å®ç°ã€
subtitle:   
date:       2019-11-3
author:     tomaså®¶çš„å°æ‹¨æµªé¼“
header-img: img/post-bg-20191014-article1.jpg
catalog: true
tags:
    - Java
    - JVM
---
# æ·±å…¥è§£æâ€œJava å­—èŠ‚ç  â€ ä¹‹ ã€Œè¿›ä¸€æ­¥æ¢ç©¶ Java æ–¹æ³•çš„å­—èŠ‚ç å®ç°ã€


> æœ¬æ–‡ä¸»è¦æ˜¯ã€Šæ·±å…¥æ¢ç´¢ JVMã€‹ç³»åˆ—ä¸­ã€å­—èŠ‚ç ç¯‡ã€æ–‡ç« ï¼Œä¸»è¦å¯¹ Java æ–¹æ³•çš„å­—èŠ‚ç å®ç°è¿›è¡Œäº†è¿›ä¸€æ­¥çš„æ·±å…¥ä»‹ç»ã€‚ç³»åˆ—æ–‡ç« ç›®å½•è§ï¼š[ã€Š æ·±å…¥æ¢ç´¢ JVM ã€‹æ–‡é›†](/programming_blog/2019/11/05/æ·±å…¥æ¢ç´¢-JVM-æ–‡é›†/)

<br>

**ã€å­—èŠ‚ç ã€ç¯‡æ–‡ç« æ¨èï¼š**   
[æ·±å…¥è§£æâ€œJava å­—èŠ‚ç  â€ ä¹‹ ã€Œç±»æ–‡ä»¶ç»“æ„ã€](/programming_blog/2019/11/01/æ·±å…¥è§£æ-Java-å­—èŠ‚ç -ä¹‹-ç±»æ–‡ä»¶ç»“æ„/)  
[æ·±å…¥è§£æâ€œJava å­—èŠ‚ç  â€ ä¹‹ ã€Œä»æ¡ˆä¾‹æ·±åº¦è§£è¯» Java å­—èŠ‚ç ã€](/programming_blog/2019/11/02/æ·±å…¥è§£æ-Java-å­—èŠ‚ç -ä¹‹-ä»æ¡ˆä¾‹æ·±åº¦è§£è¯»-Java-å­—èŠ‚ç /)  
[æ·±å…¥è§£æâ€œJava å­—èŠ‚ç  â€ ä¹‹ ã€Œè¿›ä¸€æ­¥æ¢ç©¶ Java æ–¹æ³•çš„å­—èŠ‚ç å®ç°ã€](/programming_blog/2019/11/03/æ·±å…¥è§£æ-Java-å­—èŠ‚ç -ä¹‹-è¿›ä¸€æ­¥æ¢ç©¶-Java-æ–¹æ³•çš„å­—èŠ‚ç å®ç°/)  
[æ·±å…¥è§£æâ€œJava å­—èŠ‚ç  â€ ä¹‹ ã€Œä»æ¡ˆä¾‹è§£è¯»è™šæ‹Ÿæœºå±æ€§è¡¨ã€](/programming_blog/2019/11/03/æ·±å…¥è§£æ-Java-å­—èŠ‚ç -ä¹‹-ä»æ¡ˆä¾‹è§£è¯»è™šæ‹Ÿæœºå±æ€§è¡¨/)  
[æ·±å…¥è§£æâ€œJava å­—èŠ‚ç  â€ ä¹‹ ã€Œè™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“ã€](/programming_blog/2019/11/03/æ·±å…¥è§£æ-Java-å­—èŠ‚ç -ä¹‹-è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“/)  
[æ·±å…¥è§£æâ€œJava å­—èŠ‚ç  â€ ä¹‹ ã€ŒåŠ¨æ€ä»£ç†çš„å®ç°ã€](/programming_blog/2019/11/03/æ·±å…¥è§£æ-Java-å­—èŠ‚ç -ä¹‹-åŠ¨æ€ä»£ç†çš„å®ç°/)  

<br>

## ä¸€ï¼Œsynchronized å…³é”®å­—æ‰€ç”Ÿæˆçš„å­—èŠ‚ç 

### 1.1 synchronized ä»£ç å—

~~~java
private void test(String str) {
    synchronized (object) {
        System.out.println("hello world");
    }
}
~~~

å­—èŠ‚ç ï¼š

~~~
  private void test(java.lang.String);
    descriptor: (Ljava/lang/String;)V
    flags: ACC_PRIVATE
    Code:
      stack=2, locals=4, args_size=2
         0: aload_0
         1: getfield      #6                  // Field object:Ljava/lang/Object;
         4: dup
         5: astore_2
         6: monitorenter
         7: getstatic     #12                 // Field java/lang/System.out:Ljava/io/PrintStream;
        10: ldc           #13                 // String hello world
        12: invokevirtual #14                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        15: aload_2
        16: monitorexit                        // æ–¹æ³•æ­£å¸¸æ‰§è¡Œï¼Œé€€å‡ºåŒæ­¥å—
        17: goto          25
        20: astore_3
        21: aload_2
        22: monitorexit                        // æ–¹æ³•æ‰§è¡Œå¼‚å¸¸ï¼Œä»¥æŠ›å¼‚å¸¸çš„æ–¹å¼ç¦»å¼€çš„åŒæ­¥å¿«
        23: aload_3
        24: athrow
        25: return
      Exception table:
         from    to  target type
             7    17    20   any
            20    23    20   any
      LineNumberTable:
        line 28: 0
        line 29: 7
        line 30: 15
        line 31: 25
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      26     0  this   Lcom/bayern/shengsiyuan/jvm_lecture/bytecode/lesson13/MyTest2;
            0      26     1   str   Ljava/lang/String;
      StackMapTable: number_of_entries = 2
        frame_type = 255 /* full_frame */
          offset_delta = 20
          locals = [ class com/bayern/shengsiyuan/jvm_lecture/bytecode/lesson13/MyTest2, class java/lang/String, class java/lang/Object ]
          stack = [ class java/lang/Throwable ]
        frame_type = 250 /* chop */
          offset_delta = 4
~~~

å­—èŠ‚ç å¯¹ã€Œsynchronized ä»£ç å—ã€æ˜¯é€šè¿‡ã€Œmonitorenterã€å’Œã€Œmonitorexitã€æŒ‡ä»¤æ¥å®ç°çš„é”çš„è·å–ä¸é‡Šæ”¾åŠ¨ä½œã€‚

å½“çº¿ç¨‹è¿›å…¥åˆ° monitorenter æŒ‡ä»¤åï¼Œçº¿ç¨‹å°†ä¼šæŒæœ‰ Monitor å¯¹è±¡ï¼Œé€€å‡º monitorenter æŒ‡ä»¤åï¼ˆå³ï¼Œæ‰§è¡Œäº† monitorexit æŒ‡ä»¤åï¼‰ï¼Œçº¿ç¨‹å°†ä¼šé‡Šæ”¾ Monitor å¯¹è±¡ã€‚

â€œmonitorenterâ€ä¸â€œmonitorexitâ€å¹¶ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œå¯èƒ½æ˜¯ä¸€å¯¹ä¸€ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€å¯¹å¤šã€‚æ¯”å¦‚ï¼ŒğŸ‘†çš„ç¤ºä¾‹ã€‚

* Qï¼šä¸ºä»€ä¹ˆğŸ‘†methodæ–¹æ³•çš„å­—èŠ‚ç ä¸­ï¼Œæœ‰ä¸¤ä¸ªâ€œmonitorexitâ€äº†ï¼Ÿ  
Aï¼šå› ä¸ºï¼Œå¯¹äºsynchronizedä¸­çš„ä»£ç å—ï¼Œæ— è®ºæ˜¯æ­£å¸¸çš„æ‰§è¡Œå®Œï¼Œè¿˜æ˜¯æ‰§è¡Œçš„è¿‡ç¨‹é‡åˆ°äº†è¿è¡Œæ—¶å¼‚å¸¸è€ŒæŠ›å‡ºå¼‚å¸¸çš„é€€å‡ºï¼Œéƒ½éœ€è¦ä¿è¯è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿé‡Šæ”¾æ‰è¿™ä¸ªå¯¹è±¡çš„é”ã€‚
å…¶ä¸­ï¼Œã€Œ16: monitorexit      // æ–¹æ³•æ­£å¸¸æ‰§è¡Œï¼Œé€€å‡ºåŒæ­¥å—ã€è€Œï¼Œã€Œ22: monitorexit    // æ–¹æ³•æ‰§è¡Œå¼‚å¸¸ï¼Œä»¥æŠ›å¼‚å¸¸çš„æ–¹å¼ç¦»å¼€çš„åŒæ­¥å¿«ã€

<br>

### 1.2 synchronized å®ä¾‹æ–¹æ³•

~~~java
private synchronized void setX(int x) {
    this.x = x;
}
~~~

å­—èŠ‚ç ï¼š

~~~
  private synchronized void setX(int);
    descriptor: (I)V
    flags: ACC_PRIVATE, ACC_SYNCHRONIZED
    Code:
      stack=2, locals=2, args_size=2
         0: aload_0
         1: iload_1
         2: putfield      #4                  // Field x:I
         5: return
      LineNumberTable:
        line 22: 0
        line 23: 5
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0       6     0  this   Lcom/bayern/shengsiyuan/jvm_lecture/bytecode/lesson13/MyTest2;
            0       6     1     x   I
~~~

å¯¹äº synchronized å…³é”®å­—ä¿®é¥°æ–¹æ³•æ¥è¯´ï¼Œå¹¶æ²¡æœ‰å‡ºç° monitorenter ä¸ monitorexit æŒ‡ä»¤ï¼Œè€Œæ˜¯å‡ºç°äº†ä¸€ä¸ª ACC\_SYNCHRONIZED æ ‡å¿—ã€‚

JVM ä½¿ç”¨äº† ACC\_SYNCHRONIZED è®¿é—®æ ‡å¿—æ¥åŒºåˆ†ä¸€ä¸ªæ–¹æ³•æ˜¯å¦ä¸ºåŒæ­¥æ–¹æ³•ï¼›å½“æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œè°ƒç”¨æŒ‡ä»¤ä¼šæ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦æ‹¥æœ‰ ACC\_SYNCHRONIZED æ ‡å¿—ã€‚å¦‚æœæœ‰ï¼Œé‚£ä¹ˆæ‰§è¡Œçº¿ç¨‹å°†ä¼šå…ˆæŒæœ‰æ–¹æ³•æ‰€åœ¨å¯¹è±¡çš„ Monitor å¯¹è±¡ï¼Œç„¶åå†å»æ‰§è¡Œæ–¹æ³•ä½“ï¼›åœ¨è¯¥æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹å‡æ— æ³•å†è·å–åˆ°è¿™ä¸ª Monitor å¯¹è±¡ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œè¯¥æ–¹æ³•åï¼Œå®ƒä¼šé‡Šæ”¾æ‰è¿™ä¸ª Monitor å¯¹è±¡ã€‚

<br>

### 1.3 synchronized é™æ€æ–¹æ³•

~~~java
public static synchronized void method() {
    System.out.println("hello world");
}
~~~

å­—èŠ‚ç ï¼š

~~~
  public static synchronized void method();
    descriptor: ()V
    flags: ACC_PUBLIC, ACC_STATIC, ACC_SYNCHRONIZED
    Code:
      stack=2, locals=0, args_size=0
         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
         3: ldc           #3                  // String hello world
         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V
         8: return
      LineNumberTable:
        line 6: 0
        line 7: 8
}
~~~

> æ³¨æ„ï¼šğŸ‘† method æ–¹æ³•çš„ â€œargs\_size = 0â€

å½“ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹å»è°ƒç”¨é™æ€çš„åŒæ­¥æ–¹æ³•çš„æ—¶å€™ï¼Œå®ƒå‘ç°è¿™ä¸ªæ–¹æ³•æœ¬èº«æ‹¥æœ‰ ACC\_STATIC å’Œ ACC\_SYNCHRONIZED å…³é”®å­—ï¼Œé‚£ä¹ˆå®ƒï¼ˆçº¿ç¨‹ï¼‰å°±çŸ¥é“è¿™ä¸ªæ–¹æ³•æœ¬èº«æ˜¯ä¸€ä¸ªé™æ€çš„åŒæ­¥æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œæ‰§è¡Œçº¿ç¨‹åœ¨æ‰§è¡Œæ–¹æ³•çš„ä»£ç å—ä¹‹å‰ï¼Œéœ€è¦å…ˆè·å–åˆ°å½“å‰æ–¹æ³•æ‰€åœ¨ç±»æ‰€å¯¹åº”çš„Classå¯¹è±¡çš„ Monitor å¯¹è±¡ã€‚å½“æ–¹æ³•æ‰§è¡Œå®Œåï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾æ‰è¿™ä¸ª Monitor å¯¹è±¡ã€‚

<br>

## äºŒï¼Œå¼‚å¸¸çš„å­—èŠ‚ç å®ç°
### 2.1 try-catch è¯­å¥å—

~~~java
public void test() {
    try {
        InputStream is = new FileInputStream("test.txt");
        ServerSocket serverSocket = new ServerSocket(9999);
        serverSocket.accept();
    } catch (FileNotFoundException ex) {
    } catch (IOException ex) {
    } catch (Exception ex) {
    } finally {
        System.out.println("finally");
    }
}
~~~

å­—èŠ‚ç ï¼š

~~~
  public void test();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=3, locals=4, args_size=1
         0: new           #2                  // class java/io/FileInputStream
         3: dup
         4: ldc           #3                  // String test.txt
         6: invokespecial #4                  // Method java/io/FileInputStream."<init>":(Ljava/lang/String;)V
         9: astore_1
        10: new           #5                  // class java/net/ServerSocket
        13: dup
        14: sipush        9999
        17: invokespecial #6                  // Method java/net/ServerSocket."<init>":(I)V
        20: astore_2
        21: aload_2
        22: invokevirtual #7                  // Method java/net/ServerSocket.accept:()Ljava/net/Socket;
        25: pop
        26: getstatic     #8                  // Field java/lang/System.out:Ljava/io/PrintStream;
        29: ldc           #9                  // String finally
        31: invokevirtual #10                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        34: goto          84
        37: astore_1
        38: getstatic     #8                  // Field java/lang/System.out:Ljava/io/PrintStream;
        41: ldc           #9                  // String finally
        43: invokevirtual #10                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        46: goto          84
        49: astore_1
        50: getstatic     #8                  // Field java/lang/System.out:Ljava/io/PrintStream;
        53: ldc           #9                  // String finally
        55: invokevirtual #10                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        58: goto          84
        61: astore_1
        62: getstatic     #8                  // Field java/lang/System.out:Ljava/io/PrintStream;
        65: ldc           #9                  // String finally
        67: invokevirtual #10                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        70: goto          84
        73: astore_3
        74: getstatic     #8                  // Field java/lang/System.out:Ljava/io/PrintStream;
        77: ldc           #9                  // String finally
        79: invokevirtual #10                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        82: aload_3
        83: athrow
        84: return
      Exception table:
         from    to  target type
             0    26    37   Class java/io/FileNotFoundException
             0    26    49   Class java/io/IOException
             0    26    61   Class java/lang/Exception
             0    26    73   any
      LineNumberTable:
        line 13: 0
        line 14: 10
        line 15: 21
        line 24: 26
        line 25: 34
        line 17: 37
        line 24: 38
        line 25: 46
        line 19: 49
        line 24: 50
        line 25: 58
        line 21: 61
        line 24: 62
        line 25: 70
        line 24: 73
        line 27: 84
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
           10      16     1    is   Ljava/io/InputStream;
           21       5     2 serverSocket   Ljava/net/ServerSocket;
            0      85     0  this   Lcom/bayern/shengsiyuan/jvm_lecture/bytecode/lesson13/MyTest3;
      StackMapTable: number_of_entries = 5
        frame_type = 101 /* same_locals_1_stack_item */
          stack = [ class java/io/FileNotFoundException ]
        frame_type = 75 /* same_locals_1_stack_item */
          stack = [ class java/io/IOException ]
        frame_type = 75 /* same_locals_1_stack_item */
          stack = [ class java/lang/Exception ]
        frame_type = 75 /* same_locals_1_stack_item */
          stack = [ class java/lang/Throwable ]
        frame_type = 10 /* same */
}
~~~

* ç®€åŒ–å‡ºä¸€ä¸ªå¼‚å¸¸æµç¨‹ï¼š

~~~
  public void test();
    Code:
      stack=3, locals=4, args_size=1
         0: new           #2                  // class java/io/FileInputStream
         3: dup
         4: ldc           #3                  // String test.txt
         6: invokespecial #4                  // Method java/io/FileInputStream."<init>":(Ljava/lang/String;)V
         
        ......
        37: astore_1                          // å°†ä¸€ä¸ªå¼•ç”¨èµ‹ç»™äº†å±€éƒ¨å˜é‡ã€‚è¿™é‡Œå°±æ˜¯å°† FileNotFoundException å¯¹è±¡å¼•ç”¨èµ‹ç»™ ex è¿™ä¸ªå±€éƒ¨å˜é‡ï¼›å¯ä»¥è¿™ä¹ˆç†è§£ã€Œnew FileInputStream("test.txt");ã€å¦‚æœå¼‚å¸¸é€€å‡ºï¼Œè¿”å›çš„å¯¹è±¡å°±æ˜¯â€˜FileNotFoundExceptionâ€™å¯¹è±¡ï¼Œè€Œéâ€˜FileInputStreamâ€™å¯¹è±¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æŒ‰é¡ºåºï¼Œåº”è¯¥æ˜¯å°†â€˜FileNotFoundExceptionâ€™æ”¾ç½®åˆ°å±€éƒ¨å˜é‡è¡¨ç´¢å¼•ä¸º 1 çš„ä½ç½®ï¼ˆæ­¤æ—¶ï¼Œå±€éƒ¨å˜é‡è¡¨ç´¢å¼•ä¸º 0 çš„ slot æ”¾ç½®ç€ this å¼•ç”¨ï¼‰ã€‚å¦‚æœï¼Œã€Œnew FileInputStream("test.txt");ã€æ­£å¸¸æ“ä½œè¿”å›ï¼Œå¾—åˆ°çš„å°±æ˜¯â€˜FileInputStreamâ€™å¯¹è±¡ï¼Œè¿™æ—¶æ”¾å…¥åˆ°å±€éƒ¨å˜é‡è¡¨ç´¢å¼• 1 çš„å˜é‡å°±æ˜¯â€˜FileInputStreamâ€™å¯¹è±¡äº†ï¼ˆå³ï¼Œå­—èŠ‚ç ã€Œ9: astore_1ã€ï¼‰ã€‚
        38: getstatic     #8                  // Field java/lang/System.out:Ljava/io/PrintStream;
        41: ldc           #9                  // String finally
        43: invokevirtual #10                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        46: goto          84
        ......        
        84: return
      Exception table:
         from    to  target type
             0    26    37   Class java/io/FileNotFoundException
             0    26    49   Class java/io/IOException
             0    26    61   Class java/lang/Exception
             0    26    73   any
}
~~~

ã€Œ37: astore_1ã€ï¼šå°†ä¸€ä¸ªå¼•ç”¨èµ‹ç»™äº†å±€éƒ¨å˜é‡ã€‚è¿™é‡Œå°±æ˜¯å°† FileNotFoundException å¯¹è±¡å¼•ç”¨èµ‹ç»™ ex è¿™ä¸ªå±€éƒ¨å˜é‡ï¼›å¯ä»¥è¿™ä¹ˆç†è§£ã€Œnew FileInputStream("test.txt");ã€å¦‚æœå¼‚å¸¸é€€å‡ºï¼Œè¿”å›çš„å¯¹è±¡å°±æ˜¯â€˜FileNotFoundExceptionâ€™å¯¹è±¡ï¼Œè€Œéâ€˜FileInputStreamâ€™å¯¹è±¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æŒ‰é¡ºåºï¼Œåº”è¯¥æ˜¯å°†â€˜FileNotFoundExceptionâ€™æ”¾ç½®åˆ°å±€éƒ¨å˜é‡è¡¨ç´¢å¼•ä¸º 1 çš„ä½ç½®ï¼ˆæ­¤æ—¶ï¼Œå±€éƒ¨å˜é‡è¡¨ç´¢å¼•ä¸º 0 çš„ slot æ”¾ç½®ç€ this å¼•ç”¨ï¼‰ã€‚å¦‚æœï¼Œã€Œnew FileInputStream("test.txt");ã€æ­£å¸¸æ“ä½œè¿”å›ï¼Œå¾—åˆ°çš„å°±æ˜¯â€˜FileInputStreamâ€™å¯¹è±¡ï¼Œè¿™æ—¶æ”¾å…¥åˆ°å±€éƒ¨å˜é‡è¡¨ç´¢å¼• 1 çš„å˜é‡å°±æ˜¯â€˜FileInputStreamâ€™å¯¹è±¡äº†ï¼ˆå³ï¼Œå­—èŠ‚ç ã€Œ9: astore\_1ã€ï¼‰ã€‚

<br>

* any ç±»å‹çš„å¼‚å¸¸

catch_type ä¸º 0ï¼ˆanyï¼‰æ—¶ï¼Œè¡¨ç¤ºå¤„ç†æ‰€æœ‰çš„å¼‚å¸¸

~~~
        73: astore_3
        74: getstatic     #8                  // Field java/lang/System.out:Ljava/io/PrintStream;
        77: ldc           #9                  // String finally
        79: invokevirtual #10                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        82: aload_3
        83: athrow
~~~

ğŸ‘†åªæœ‰ any ç±»å‹çš„å¼‚å¸¸ï¼Œä¼šåœ¨æ‰§è¡Œå®Œã€Œfinally{}ã€ä»£ç å—åï¼Œå°†å¼‚å¸¸æŠ›å‡ºï¼ˆæ‰§è¡Œã€Œathrowã€ï¼‰åç›´æ¥é€€å‡ºï¼ˆè¿™é‡Œä¸ä¼šå†æ‰§è¡Œã€Œreturnã€å­—èŠ‚ç æŒ‡ä»¤äº†ï¼Œå› ä¸ºè¿™é‡Œçš„å¼‚å¸¸ç±»å‹æ²¡æœ‰è¢« catch æ•è·ï¼‰ã€‚å…¶ä»–ç±»å‹çš„å¼‚å¸¸ï¼Œéƒ½æ˜¯æ‰§è¡Œå®Œã€Œcatch{}ã€ä»£ç å—åï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæœ€åå†æ‰§è¡Œã€Œfinally{}ã€ä»£ç å—ï¼Œç„¶åæ‰§è¡Œé€€å‡ºæ–¹æ³•ï¼ˆã€Œreturnã€ï¼‰ã€‚

<br>

* Java å­—èŠ‚ç å¯¹äºå¼‚å¸¸çš„å¤„ç†æ–¹å¼:  
 
	1. ç»Ÿä¸€é‡‡ç”¨å¼‚å¸¸è¡¨çš„æ–¹å¼æ¥å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚
	2. åœ¨jdk 1.4.2 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¹¶ä¸æ˜¯ä½¿ç”¨å¼‚å¸¸è¡¨çš„æ–¹å¼æ¥å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†çš„ï¼Œè€Œæ˜¯é‡‡ç”¨ç‰¹å®šçš„æŒ‡ä»¤æ–¹å¼ã€‚
	3. å½“å¼‚å¸¸å¤„ç†å­˜åœ¨ finally è¯­å¥å—æ—¶ï¼Œç°ä»£åŒ–çš„ JVM é‡‡å–çš„å¤„ç†æ–¹å¼æ˜¯å°† finally è¯­å¥å—çš„å­—èŠ‚ç æ‹¼æ¥åˆ°æ¯ä¸€ä¸ª catch å—åé¢ã€‚æ¢å¥è¯è¯´ï¼Œç¨‹åºä¸­å­˜åœ¨å¤šå°‘ä¸ª catch å—ï¼Œå°±ä¼šåœ¨æ¯ä¸€ä¸ª catch å—åé¢é‡å¤å¤šå°‘ä¸ª finally è¯­å¥å—çš„å­—èŠ‚ç ã€‚ï¼ˆè¿™ç§å®ç°æ–¹å¼ï¼Œèƒ½å‡å°‘è·³è½¬ï¼Œå³ï¼Œgotoï¼‰

<br>

### 2.2 æ–¹æ³•æ˜¾ç¤ºå£°æ˜æŠ›å‡ºå¼‚å¸¸

~~~java
public void test() throws IOException, FileNotFoundException {
    try {
        InputStream is = new FileInputStream("test.txt");
        ServerSocket serverSocket = new ServerSocket(9999);
        serverSocket.accept();
    } catch (FileNotFoundException ex1) {
    } catch (IOException ex2) {
    } catch (Exception ex3) {
    } finally {
        System.out.println("finally");
    }
}
~~~

å¯¹åº”å­—èŠ‚ç ï¼š

~~~
public void test() throws java.io.IOException, java.io.FileNotFoundException;
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=3, locals=4, args_size=1
         0: new           #2                  // class java/io/FileInputStream
         3: dup
        
        ......
    Exceptions:
      throws java.io.IOException, java.io.FileNotFoundException
}

~~~

![](https://tva1.sinaimg.cn/large/006y8mN6ly1g8mjhpuztbj30zr08uabs.jpg)  
å½“æ–¹æ³•å£°æ˜ä¸­æœ‰throwså¼‚å¸¸æ—¶ï¼Œå­—èŠ‚ç ä¼šå‡ºç°â€™exception attributeâ€™ï¼Œå®ƒå’Œâ€™code attributeâ€™æ˜¯åŒçº§çš„ï¼Œéƒ½æ˜¯æ–¹æ³•çš„å±æ€§ã€‚

<br>

## ä¸‰ï¼Œå±€éƒ¨å˜é‡è¡¨
å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variable Tableï¼‰æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜æ”¾ aï¼‰æ–¹æ³•å‚æ•°å’Œbï¼‰æ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚

å±€éƒ¨å˜é‡è¡¨çš„å®¹é‡ä»¥å˜é‡æ§½ï¼ˆVariable Slotï¼Œä¸‹ç§°Slotï¼‰ä¸ºæœ€å°å•ä½ã€‚

åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºæ˜¯ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆã€Œå‚æ•°å€¼ã€ åˆ° ã€Œå‚æ•°å˜é‡åˆ—è¡¨ã€çš„ä¼ é€’è¿‡ç¨‹çš„ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯å®ä¾‹æ–¹æ³•ï¼ˆéstaticçš„æ–¹æ³•ï¼‰ï¼Œé‚£å±€éƒ¨å˜é‡è¡¨ä¸­ç¬¬0ä½ç´¢å¼•çš„Sloté»˜è®¤æ˜¯ç”¨äºä¼ é€’æ–¹æ³•æ‰€å±å¯¹è±¡å®ä¾‹çš„å¼•ç”¨ï¼Œåœ¨æ–¹æ³•ä¸­å¯ä»¥é€šè¿‡å…³é”®å­—"this"æ¥è®¿é—®åˆ°è¿™ä¸ªéšå«çš„å‚æ•°ã€‚å…¶ä½™å‚æ•°åˆ™æŒ‰ç…§å‚æ•°è¡¨é¡ºåºæ’åˆ—ï¼Œå ç”¨ä»1å¼€å§‹çš„å±€éƒ¨å˜é‡Slotï¼Œå‚æ•°è¡¨åˆ†é…å®Œæ¯•åï¼Œå†æ ¹æ®æ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å˜é‡é¡ºåºå’Œä½œç”¨åŸŸåˆ†é…å…¶ä½™çš„Slotã€‚

ä¸ºäº†å°½å¯èƒ½èŠ‚çœæ ˆå¸§ç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­çš„Slotæ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œæ–¹æ³•ä½“ä¸­å®šä¹‰çš„å˜é‡ï¼Œå…¶ä½œç”¨åŸŸå¹¶ä¸ä¸€å®šä¼šè¦†ç›–æ•´ä¸ªæ–¹æ³•ä½“ï¼Œå¦‚æœå½“å‰å­—èŠ‚ç PCè®¡æ•°å™¨çš„å€¼å·²ç»è¶…å‡ºäº†æŸä¸ªå˜é‡çš„ä½œç”¨åŸŸï¼Œé‚£è¿™ä¸ªå˜é‡å¯¹åº”çš„Slotå°±å¯ä»¥äº¤ç»™å…¶ä»–å˜é‡ä½¿ç”¨ã€‚  
ä¸è¿‡ï¼Œè¿™æ ·çš„è®¾è®¡é™¤äº†èŠ‚çœæ ˆå¸§ç©ºé—´ä»¥å¤–ï¼Œè¿˜ä¼šä¼´éšä¸€äº›é¢å¤–çš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒSlotçš„å¤ç”¨ä¼šç›´æ¥å½±å“åˆ°ç³»ç»Ÿçš„åƒåœ¾æ”¶é›†è¡Œä¸ºï¼š  

~~~
public static void main(String[]args)() {
    byte[] placeholder = new byte[64*1024*1024]ï¼›
    System.gc()ï¼›
}
~~~

æˆ‘ä»¬åœ¨è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ä¸­åŠ ä¸Š"-verbose:gc"æ¥çœ‹çœ‹åƒåœ¾æ”¶é›†çš„è¿‡ç¨‹ï¼Œå‘ç°åœ¨System.gc()è¿è¡Œåå¹¶æ²¡æœ‰å›æ”¶è¿™64MBçš„å†…å­˜ï¼š  
![](https://tva1.sinaimg.cn/large/006y8mN6ly1g8mjlavv0gj30c4018glm.jpg)  
æ²¡æœ‰å›æ”¶placeholderæ‰€å çš„å†…å­˜èƒ½è¯´å¾—è¿‡å»ï¼Œå› ä¸ºåœ¨æ‰§è¡ŒSystem.gc()æ—¶ï¼Œå˜é‡placeholderè¿˜å¤„äºä½œç”¨åŸŸä¹‹å†…ï¼Œè™šæ‹Ÿæœºè‡ªç„¶ä¸æ•¢å›æ”¶placeholderçš„å†…å­˜ã€‚é‚£æˆ‘ä»¬æŠŠä»£ç ä¿®æ”¹ä¸€ä¸‹ï¼š

~~~
# ä»£ç æ¸…å• 8-2
public static void main(String[]args)() {
    {
        byte[] placeholder = new byte[64*1024*1024]ï¼›
    }
    System.gc()ï¼›
}
~~~

åŠ å…¥äº†èŠ±æ‹¬å·ä¹‹åï¼Œplaceholderçš„ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨èŠ±æ‹¬å·ä¹‹å†…ï¼Œä»ä»£ç é€»è¾‘ä¸Šè®²ï¼Œåœ¨æ‰§è¡ŒSystem.gc()çš„æ—¶å€™ï¼Œplaceholderå·²ç»ä¸å¯èƒ½å†è¢«è®¿é—®äº†ï¼Œä½†æ‰§è¡Œä¸€ä¸‹è¿™æ®µç¨‹åºï¼Œä¼šå‘ç°è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œè¿˜æ˜¯æœ‰64MBçš„å†…å­˜æ²¡æœ‰è¢«å›æ”¶ï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ  
![](https://tva1.sinaimg.cn/large/006y8mN6ly1g8mjkumpfmj30b4014q2x.jpg)  
åœ¨è§£é‡Šä¸ºä»€ä¹ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯¹è¿™æ®µä»£ç è¿›è¡Œç¬¬äºŒæ¬¡ä¿®æ”¹ï¼Œåœ¨è°ƒç”¨System.gc()ä¹‹å‰åŠ å…¥ä¸€è¡Œ"int a=0ï¼›â€ï¼š

~~~
# ä»£ç æ¸…å• 8-3
public static void main(String[]args)() {
    {
    byte[] placeholder = new byte[64*1024*1024]ï¼›
    }
    int a=0ï¼›
    System.gc()ï¼›
}
~~~

è¿™ä¸ªä¿®æ”¹çœ‹èµ·æ¥å¾ˆè«åå…¶å¦™ï¼Œä½†è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œå´å‘ç°è¿™æ¬¡å†…å­˜çœŸçš„è¢«æ­£ç¡®å›æ”¶äº†ã€‚

**placeholderèƒ½å¦è¢«å›æ”¶çš„æ ¹æœ¬åŸå› æ˜¯ï¼šå±€éƒ¨å˜é‡è¡¨ä¸­çš„Slotæ˜¯å¦è¿˜å­˜æœ‰å…³äºplaceholderæ•°ç»„å¯¹è±¡çš„å¼•ç”¨ã€‚ç¬¬ä¸€æ¬¡ä¿®æ”¹ä¸­ï¼Œä»£ç è™½ç„¶å·²ç»ç¦»å¼€äº†placeholderçš„ä½œç”¨åŸŸï¼Œä½†åœ¨æ­¤ä¹‹åï¼Œæ²¡æœ‰ä»»ä½•å¯¹å±€éƒ¨å˜é‡è¡¨çš„è¯»å†™æ“ä½œï¼ŒplaceholderåŸæœ¬æ‰€å ç”¨çš„Slotè¿˜æ²¡æœ‰è¢«å…¶ä»–å˜é‡æ‰€å¤ç”¨ï¼Œæ‰€ä»¥ä½œä¸ºGC Rootsä¸€éƒ¨åˆ†çš„å±€éƒ¨å˜é‡è¡¨ä»ç„¶ä¿æŒç€å¯¹å®ƒçš„å…³è”ã€‚**  
è¿™ç§å…³è”æ²¡æœ‰è¢«åŠæ—¶æ‰“æ–­ï¼Œåœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹å½±å“éƒ½å¾ˆè½»å¾®ã€‚`ä½†å¦‚æœé‡åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶åé¢çš„ä»£ç æœ‰ä¸€äº›è€—æ—¶å¾ˆé•¿çš„æ“ä½œï¼Œè€Œå‰é¢åˆå®šä¹‰äº†å ç”¨äº†å¤§é‡å†…å­˜ã€å®é™…ä¸Šå·²ç»ä¸ä¼šå†ä½¿ç”¨çš„å˜é‡ï¼Œæ‰‹åŠ¨å°†å…¶è®¾ç½®ä¸ºnullå€¼ï¼ˆç”¨æ¥ä»£æ›¿é‚£å¥int a=0ï¼ŒæŠŠå˜é‡å¯¹åº”çš„å±€éƒ¨å˜é‡è¡¨Slotæ¸…ç©ºï¼‰ä¾¿ä¸è§å¾—æ˜¯ä¸€ä¸ªç»å¯¹æ— æ„ä¹‰çš„æ“ä½œï¼Œè¿™ç§æ“ä½œå¯ä»¥ä½œä¸ºä¸€ç§åœ¨æç‰¹æ®Šæƒ…å½¢ï¼ˆå¯¹è±¡å ç”¨å†…å­˜å¤§ã€æ­¤æ–¹æ³•çš„æ ˆå¸§é•¿æ—¶é—´ä¸èƒ½è¢«å›æ”¶ã€æ–¹æ³•è°ƒç”¨æ¬¡æ•°è¾¾ä¸åˆ°JITçš„ç¼–è¯‘æ¡ä»¶ï¼‰ä¸‹çš„â€œå¥‡æŠ€â€æ¥ä½¿ç”¨ã€‚`

ä½†æ˜¯ä¸åº”å½“å¯¹èµ‹nullå€¼çš„æ“ä½œæœ‰è¿‡å¤šçš„ä¾èµ–ï¼Œæ›´æ²¡æœ‰å¿…è¦æŠŠå®ƒå½“åšä¸€ä¸ªæ™®éçš„ç¼–ç è§„åˆ™æ¥æ¨å¹¿ã€‚åŸå› æœ‰ä¸¤ç‚¹ï¼š  
â‘  ä»ç¼–ç è§’åº¦è®²ï¼Œä»¥æ°å½“çš„å˜é‡ä½œç”¨åŸŸæ¥æ§åˆ¶å˜é‡å›æ”¶æ—¶é—´æ‰æ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ³•ï¼Œå¦‚ä»£ç æ¸…å• 8-3 é‚£æ ·çš„åœºæ™¯å¹¶ä¸å¤šè§ã€‚  
â‘¡ æ›´å…³é”®çš„æ˜¯ï¼Œä»æ‰§è¡Œè§’åº¦è®²ï¼Œä½¿ç”¨èµ‹nullå€¼çš„æ“ä½œæ¥ä¼˜åŒ–å†…å­˜å›æ”¶æ˜¯å»ºç«‹åœ¨å¯¹å­—èŠ‚ç æ‰§è¡Œå¼•æ“æ¦‚å¿µæ¨¡å‹çš„ç†è§£ä¹‹ä¸Šçš„ã€‚  

å…³äºå±€éƒ¨å˜é‡è¡¨ï¼Œè¿˜æœ‰ä¸€ç‚¹å¯èƒ½ä¼šå¯¹å®é™…å¼€å‘äº§ç”Ÿå½±å“ï¼Œå°±æ˜¯å±€éƒ¨å˜é‡ä¸åƒå‰é¢ä»‹ç»çš„ç±»å˜é‡é‚£æ ·å­˜åœ¨â€œå‡†å¤‡é˜¶æ®µâ€ã€‚å±€éƒ¨å˜é‡å°±ä¸ä¸€æ ·ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡å®šä¹‰äº†ä½†æ²¡æœ‰èµ‹åˆå§‹å€¼æ˜¯ä¸èƒ½ä½¿ç”¨çš„ã€‚  
è¿˜å¥½ç¼–è¯‘å™¨èƒ½åœ¨ç¼–è¯‘æœŸé—´å°±æ£€æŸ¥åˆ°å¹¶æç¤ºè¿™ä¸€ç‚¹ï¼Œå³ä¾¿ç¼–è¯‘èƒ½é€šè¿‡æˆ–è€…æ‰‹åŠ¨ç”Ÿæˆå­—èŠ‚ç çš„æ–¹å¼åˆ¶é€ å‡ºä¸‹é¢ä»£ç çš„æ•ˆæœï¼Œå­—èŠ‚ç æ ¡éªŒçš„æ—¶å€™ä¹Ÿä¼šè¢«è™šæ‹Ÿæœºå‘ç°è€Œå¯¼è‡´ç±»åŠ è½½å¤±è´¥ã€‚

<br>

## å››ï¼Œ\<init> æ–¹æ³•
å¯¹äºå­—èŠ‚ç æ–‡ä»¶æœ¬èº«æ¥è¯´ï¼Œ Methods ä¸­æ˜¯å¯ä»¥ä¸åŒ…å« <init> æ–¹æ³•çš„ã€‚  
åŒæ—¶ï¼Œå°± Java å­—èŠ‚ç æ¥è¯´ï¼ŒMethods ä¸­ä¹Ÿå¯ä»¥ä¸åŒ…å« <init> æ–¹æ³•çš„ã€‚

* abstract ç±»çš„å­—èŠ‚ç çš„ Methods ä¸­åŒ…å« <init> æ–¹æ³•ï¼Œä½†æˆ‘ä»¬çŸ¥é“æŠ½è±¡ç±»æ˜¯æ— æ³•è¢«å®ä¾‹åŒ–çš„ï¼Œè€Œè¿™é‡Œçš„ <init> æ–¹æ³•å®ä¾‹åŒ–çš„æ˜¯çˆ¶ç±» Object ç±»ã€‚Java ä¸­æ‰€æœ‰çš„ç±»éƒ½ä¼šé»˜è®¤ç»§æ‰¿ Object ç±»ã€‚

![](https://tva1.sinaimg.cn/large/006y8mN6ly1g8mjnq7p19j30zb07adhl.jpg)  
![](https://tva1.sinaimg.cn/large/006y8mN6ly1g8mjo642fqj30zl04h3zi.jpg)  

* interface çš„å­—èŠ‚ç çš„ Methods ä¸­æ˜¯ä¸åŒ…å« <init> æ–¹æ³•çš„ï¼æ¥å£æ˜¯æ— æ³•è¢«å®ä¾‹åŒ–çš„  

![](https://tva1.sinaimg.cn/large/006y8mN6ly1g8mjosark0j30zl06twge.jpg)
























